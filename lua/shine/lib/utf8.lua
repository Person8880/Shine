--[[
	UTF-8 character encoding helpers.

	Massive data dump at the start for upper -> lower case and vice-versa.
]]

local BitBand = bit.band
local BitBor = bit.bor
local BitLShift = bit.lshift
local BitRShift = bit.rshift
local error = error
local Max = math.max
local Min = math.min
local select = select
local StringByte = string.byte
local StringChar = string.char
local StringFormat = string.format
local StringSub = string.sub
local TableClear = require "table.clear"
local TableConcat = table.concat
local TableReverse = table.Reverse
local type = type
local unpack = unpack

local UTF8LowerToUpper = {
	["a"] = "A",
	["b"] = "B",
	["c"] = "C",
	["d"] = "D",
	["e"] = "E",
	["f"] = "F",
	["g"] = "G",
	["h"] = "H",
	["i"] = "I",
	["j"] = "J",
	["k"] = "K",
	["l"] = "L",
	["m"] = "M",
	["n"] = "N",
	["o"] = "O",
	["p"] = "P",
	["q"] = "Q",
	["r"] = "R",
	["s"] = "S",
	["t"] = "T",
	["u"] = "U",
	["v"] = "V",
	["w"] = "W",
	["x"] = "X",
	["y"] = "Y",
	["z"] = "Z",
	["Âµ"] = "Îœ",
	["Ã "] = "Ã€",
	["Ã¡"] = "Ã",
	["Ã¢"] = "Ã‚",
	["Ã£"] = "Ãƒ",
	["Ã¤"] = "Ã„",
	["Ã¥"] = "Ã…",
	["Ã¦"] = "Ã†",
	["Ã§"] = "Ã‡",
	["Ã¨"] = "Ãˆ",
	["Ã©"] = "Ã‰",
	["Ãª"] = "ÃŠ",
	["Ã«"] = "Ã‹",
	["Ã¬"] = "ÃŒ",
	["Ã­"] = "Ã",
	["Ã®"] = "ÃŽ",
	["Ã¯"] = "Ã",
	["Ã°"] = "Ã",
	["Ã±"] = "Ã‘",
	["Ã²"] = "Ã’",
	["Ã³"] = "Ã“",
	["Ã´"] = "Ã”",
	["Ãµ"] = "Ã•",
	["Ã¶"] = "Ã–",
	["Ã¸"] = "Ã˜",
	["Ã¹"] = "Ã™",
	["Ãº"] = "Ãš",
	["Ã»"] = "Ã›",
	["Ã¼"] = "Ãœ",
	["Ã½"] = "Ã",
	["Ã¾"] = "Ãž",
	["Ã¿"] = "Å¸",
	["Ä"] = "Ä€",
	["Äƒ"] = "Ä‚",
	["Ä…"] = "Ä„",
	["Ä‡"] = "Ä†",
	["Ä‰"] = "Äˆ",
	["Ä‹"] = "ÄŠ",
	["Ä"] = "ÄŒ",
	["Ä"] = "ÄŽ",
	["Ä‘"] = "Ä",
	["Ä“"] = "Ä’",
	["Ä•"] = "Ä”",
	["Ä—"] = "Ä–",
	["Ä™"] = "Ä˜",
	["Ä›"] = "Äš",
	["Ä"] = "Äœ",
	["ÄŸ"] = "Äž",
	["Ä¡"] = "Ä ",
	["Ä£"] = "Ä¢",
	["Ä¥"] = "Ä¤",
	["Ä§"] = "Ä¦",
	["Ä©"] = "Ä¨",
	["Ä«"] = "Äª",
	["Ä­"] = "Ä¬",
	["Ä¯"] = "Ä®",
	["Ä±"] = "I",
	["Ä³"] = "Ä²",
	["Äµ"] = "Ä´",
	["Ä·"] = "Ä¶",
	["Äº"] = "Ä¹",
	["Ä¼"] = "Ä»",
	["Ä¾"] = "Ä½",
	["Å€"] = "Ä¿",
	["Å‚"] = "Å",
	["Å„"] = "Åƒ",
	["Å†"] = "Å…",
	["Åˆ"] = "Å‡",
	["Å‹"] = "ÅŠ",
	["Å"] = "ÅŒ",
	["Å"] = "ÅŽ",
	["Å‘"] = "Å",
	["Å“"] = "Å’",
	["Å•"] = "Å”",
	["Å—"] = "Å–",
	["Å™"] = "Å˜",
	["Å›"] = "Åš",
	["Å"] = "Åœ",
	["ÅŸ"] = "Åž",
	["Å¡"] = "Å ",
	["Å£"] = "Å¢",
	["Å¥"] = "Å¤",
	["Å§"] = "Å¦",
	["Å©"] = "Å¨",
	["Å«"] = "Åª",
	["Å­"] = "Å¬",
	["Å¯"] = "Å®",
	["Å±"] = "Å°",
	["Å³"] = "Å²",
	["Åµ"] = "Å´",
	["Å·"] = "Å¶",
	["Åº"] = "Å¹",
	["Å¼"] = "Å»",
	["Å¾"] = "Å½",
	["Å¿"] = "S",
	["Æ€"] = "Éƒ",
	["Æƒ"] = "Æ‚",
	["Æ…"] = "Æ„",
	["Æˆ"] = "Æ‡",
	["ÆŒ"] = "Æ‹",
	["Æ’"] = "Æ‘",
	["Æ•"] = "Ç¶",
	["Æ™"] = "Æ˜",
	["Æš"] = "È½",
	["Æž"] = "È ",
	["Æ¡"] = "Æ ",
	["Æ£"] = "Æ¢",
	["Æ¥"] = "Æ¤",
	["Æ¨"] = "Æ§",
	["Æ­"] = "Æ¬",
	["Æ°"] = "Æ¯",
	["Æ´"] = "Æ³",
	["Æ¶"] = "Æµ",
	["Æ¹"] = "Æ¸",
	["Æ½"] = "Æ¼",
	["Æ¿"] = "Ç·",
	["Ç…"] = "Ç„",
	["Ç†"] = "Ç„",
	["Çˆ"] = "Ç‡",
	["Ç‰"] = "Ç‡",
	["Ç‹"] = "ÇŠ",
	["ÇŒ"] = "ÇŠ",
	["ÇŽ"] = "Ç",
	["Ç"] = "Ç",
	["Ç’"] = "Ç‘",
	["Ç”"] = "Ç“",
	["Ç–"] = "Ç•",
	["Ç˜"] = "Ç—",
	["Çš"] = "Ç™",
	["Çœ"] = "Ç›",
	["Ç"] = "ÆŽ",
	["ÇŸ"] = "Çž",
	["Ç¡"] = "Ç ",
	["Ç£"] = "Ç¢",
	["Ç¥"] = "Ç¤",
	["Ç§"] = "Ç¦",
	["Ç©"] = "Ç¨",
	["Ç«"] = "Çª",
	["Ç­"] = "Ç¬",
	["Ç¯"] = "Ç®",
	["Ç²"] = "Ç±",
	["Ç³"] = "Ç±",
	["Çµ"] = "Ç´",
	["Ç¹"] = "Ç¸",
	["Ç»"] = "Çº",
	["Ç½"] = "Ç¼",
	["Ç¿"] = "Ç¾",
	["È"] = "È€",
	["Èƒ"] = "È‚",
	["È…"] = "È„",
	["È‡"] = "È†",
	["È‰"] = "Èˆ",
	["È‹"] = "ÈŠ",
	["È"] = "ÈŒ",
	["È"] = "ÈŽ",
	["È‘"] = "È",
	["È“"] = "È’",
	["È•"] = "È”",
	["È—"] = "È–",
	["È™"] = "È˜",
	["È›"] = "Èš",
	["È"] = "Èœ",
	["ÈŸ"] = "Èž",
	["È£"] = "È¢",
	["È¥"] = "È¤",
	["È§"] = "È¦",
	["È©"] = "È¨",
	["È«"] = "Èª",
	["È­"] = "È¬",
	["È¯"] = "È®",
	["È±"] = "È°",
	["È³"] = "È²",
	["È¼"] = "È»",
	["É‚"] = "É",
	["É‡"] = "É†",
	["É‰"] = "Éˆ",
	["É‹"] = "ÉŠ",
	["É"] = "ÉŒ",
	["É"] = "ÉŽ",
	["É“"] = "Æ",
	["É”"] = "Æ†",
	["É–"] = "Æ‰",
	["É—"] = "ÆŠ",
	["É™"] = "Æ",
	["É›"] = "Æ",
	["É "] = "Æ“",
	["É£"] = "Æ”",
	["É¨"] = "Æ—",
	["É©"] = "Æ–",
	["É«"] = "â±¢",
	["É¯"] = "Æœ",
	["É²"] = "Æ",
	["Éµ"] = "ÆŸ",
	["É½"] = "â±¤",
	["Ê€"] = "Æ¦",
	["Êƒ"] = "Æ©",
	["Êˆ"] = "Æ®",
	["Ê‰"] = "É„",
	["ÊŠ"] = "Æ±",
	["Ê‹"] = "Æ²",
	["ÊŒ"] = "É…",
	["Ê’"] = "Æ·",
	["Í…"] = "Î™",
	["Í»"] = "Ï½",
	["Í¼"] = "Ï¾",
	["Í½"] = "Ï¿",
	["Î¬"] = "Î†",
	["Î­"] = "Îˆ",
	["Î®"] = "Î‰",
	["Î¯"] = "ÎŠ",
	["Î±"] = "Î‘",
	["Î²"] = "Î’",
	["Î³"] = "Î“",
	["Î´"] = "Î”",
	["Îµ"] = "Î•",
	["Î¶"] = "Î–",
	["Î·"] = "Î—",
	["Î¸"] = "Î˜",
	["Î¹"] = "Î™",
	["Îº"] = "Îš",
	["Î»"] = "Î›",
	["Î¼"] = "Îœ",
	["Î½"] = "Î",
	["Î¾"] = "Îž",
	["Î¿"] = "ÎŸ",
	["Ï€"] = "Î ",
	["Ï"] = "Î¡",
	["Ï‚"] = "Î£",
	["Ïƒ"] = "Î£",
	["Ï„"] = "Î¤",
	["Ï…"] = "Î¥",
	["Ï†"] = "Î¦",
	["Ï‡"] = "Î§",
	["Ïˆ"] = "Î¨",
	["Ï‰"] = "Î©",
	["ÏŠ"] = "Îª",
	["Ï‹"] = "Î«",
	["ÏŒ"] = "ÎŒ",
	["Ï"] = "ÎŽ",
	["ÏŽ"] = "Î",
	["Ï"] = "Î’",
	["Ï‘"] = "Î˜",
	["Ï•"] = "Î¦",
	["Ï–"] = "Î ",
	["Ï™"] = "Ï˜",
	["Ï›"] = "Ïš",
	["Ï"] = "Ïœ",
	["ÏŸ"] = "Ïž",
	["Ï¡"] = "Ï ",
	["Ï£"] = "Ï¢",
	["Ï¥"] = "Ï¤",
	["Ï§"] = "Ï¦",
	["Ï©"] = "Ï¨",
	["Ï«"] = "Ïª",
	["Ï­"] = "Ï¬",
	["Ï¯"] = "Ï®",
	["Ï°"] = "Îš",
	["Ï±"] = "Î¡",
	["Ï²"] = "Ï¹",
	["Ïµ"] = "Î•",
	["Ï¸"] = "Ï·",
	["Ï»"] = "Ïº",
	["Ð°"] = "Ð",
	["Ð±"] = "Ð‘",
	["Ð²"] = "Ð’",
	["Ð³"] = "Ð“",
	["Ð´"] = "Ð”",
	["Ðµ"] = "Ð•",
	["Ð¶"] = "Ð–",
	["Ð·"] = "Ð—",
	["Ð¸"] = "Ð˜",
	["Ð¹"] = "Ð™",
	["Ðº"] = "Ðš",
	["Ð»"] = "Ð›",
	["Ð¼"] = "Ðœ",
	["Ð½"] = "Ð",
	["Ð¾"] = "Ðž",
	["Ð¿"] = "ÐŸ",
	["Ñ€"] = "Ð ",
	["Ñ"] = "Ð¡",
	["Ñ‚"] = "Ð¢",
	["Ñƒ"] = "Ð£",
	["Ñ„"] = "Ð¤",
	["Ñ…"] = "Ð¥",
	["Ñ†"] = "Ð¦",
	["Ñ‡"] = "Ð§",
	["Ñˆ"] = "Ð¨",
	["Ñ‰"] = "Ð©",
	["ÑŠ"] = "Ðª",
	["Ñ‹"] = "Ð«",
	["ÑŒ"] = "Ð¬",
	["Ñ"] = "Ð­",
	["ÑŽ"] = "Ð®",
	["Ñ"] = "Ð¯",
	["Ñ"] = "Ð€",
	["Ñ‘"] = "Ð",
	["Ñ’"] = "Ð‚",
	["Ñ“"] = "Ðƒ",
	["Ñ”"] = "Ð„",
	["Ñ•"] = "Ð…",
	["Ñ–"] = "Ð†",
	["Ñ—"] = "Ð‡",
	["Ñ˜"] = "Ðˆ",
	["Ñ™"] = "Ð‰",
	["Ñš"] = "ÐŠ",
	["Ñ›"] = "Ð‹",
	["Ñœ"] = "ÐŒ",
	["Ñ"] = "Ð",
	["Ñž"] = "ÐŽ",
	["ÑŸ"] = "Ð",
	["Ñ¡"] = "Ñ ",
	["Ñ£"] = "Ñ¢",
	["Ñ¥"] = "Ñ¤",
	["Ñ§"] = "Ñ¦",
	["Ñ©"] = "Ñ¨",
	["Ñ«"] = "Ñª",
	["Ñ­"] = "Ñ¬",
	["Ñ¯"] = "Ñ®",
	["Ñ±"] = "Ñ°",
	["Ñ³"] = "Ñ²",
	["Ñµ"] = "Ñ´",
	["Ñ·"] = "Ñ¶",
	["Ñ¹"] = "Ñ¸",
	["Ñ»"] = "Ñº",
	["Ñ½"] = "Ñ¼",
	["Ñ¿"] = "Ñ¾",
	["Ò"] = "Ò€",
	["Ò‹"] = "ÒŠ",
	["Ò"] = "ÒŒ",
	["Ò"] = "ÒŽ",
	["Ò‘"] = "Ò",
	["Ò“"] = "Ò’",
	["Ò•"] = "Ò”",
	["Ò—"] = "Ò–",
	["Ò™"] = "Ò˜",
	["Ò›"] = "Òš",
	["Ò"] = "Òœ",
	["ÒŸ"] = "Òž",
	["Ò¡"] = "Ò ",
	["Ò£"] = "Ò¢",
	["Ò¥"] = "Ò¤",
	["Ò§"] = "Ò¦",
	["Ò©"] = "Ò¨",
	["Ò«"] = "Òª",
	["Ò­"] = "Ò¬",
	["Ò¯"] = "Ò®",
	["Ò±"] = "Ò°",
	["Ò³"] = "Ò²",
	["Òµ"] = "Ò´",
	["Ò·"] = "Ò¶",
	["Ò¹"] = "Ò¸",
	["Ò»"] = "Òº",
	["Ò½"] = "Ò¼",
	["Ò¿"] = "Ò¾",
	["Ó‚"] = "Ó",
	["Ó„"] = "Óƒ",
	["Ó†"] = "Ó…",
	["Óˆ"] = "Ó‡",
	["ÓŠ"] = "Ó‰",
	["ÓŒ"] = "Ó‹",
	["ÓŽ"] = "Ó",
	["Ó"] = "Ó€",
	["Ó‘"] = "Ó",
	["Ó“"] = "Ó’",
	["Ó•"] = "Ó”",
	["Ó—"] = "Ó–",
	["Ó™"] = "Ó˜",
	["Ó›"] = "Óš",
	["Ó"] = "Óœ",
	["ÓŸ"] = "Óž",
	["Ó¡"] = "Ó ",
	["Ó£"] = "Ó¢",
	["Ó¥"] = "Ó¤",
	["Ó§"] = "Ó¦",
	["Ó©"] = "Ó¨",
	["Ó«"] = "Óª",
	["Ó­"] = "Ó¬",
	["Ó¯"] = "Ó®",
	["Ó±"] = "Ó°",
	["Ó³"] = "Ó²",
	["Óµ"] = "Ó´",
	["Ó·"] = "Ó¶",
	["Ó¹"] = "Ó¸",
	["Ó»"] = "Óº",
	["Ó½"] = "Ó¼",
	["Ó¿"] = "Ó¾",
	["Ô"] = "Ô€",
	["Ôƒ"] = "Ô‚",
	["Ô…"] = "Ô„",
	["Ô‡"] = "Ô†",
	["Ô‰"] = "Ôˆ",
	["Ô‹"] = "ÔŠ",
	["Ô"] = "ÔŒ",
	["Ô"] = "ÔŽ",
	["Ô‘"] = "Ô",
	["Ô“"] = "Ô’",
	["Õ¡"] = "Ô±",
	["Õ¢"] = "Ô²",
	["Õ£"] = "Ô³",
	["Õ¤"] = "Ô´",
	["Õ¥"] = "Ôµ",
	["Õ¦"] = "Ô¶",
	["Õ§"] = "Ô·",
	["Õ¨"] = "Ô¸",
	["Õ©"] = "Ô¹",
	["Õª"] = "Ôº",
	["Õ«"] = "Ô»",
	["Õ¬"] = "Ô¼",
	["Õ­"] = "Ô½",
	["Õ®"] = "Ô¾",
	["Õ¯"] = "Ô¿",
	["Õ°"] = "Õ€",
	["Õ±"] = "Õ",
	["Õ²"] = "Õ‚",
	["Õ³"] = "Õƒ",
	["Õ´"] = "Õ„",
	["Õµ"] = "Õ…",
	["Õ¶"] = "Õ†",
	["Õ·"] = "Õ‡",
	["Õ¸"] = "Õˆ",
	["Õ¹"] = "Õ‰",
	["Õº"] = "ÕŠ",
	["Õ»"] = "Õ‹",
	["Õ¼"] = "ÕŒ",
	["Õ½"] = "Õ",
	["Õ¾"] = "ÕŽ",
	["Õ¿"] = "Õ",
	["Ö€"] = "Õ",
	["Ö"] = "Õ‘",
	["Ö‚"] = "Õ’",
	["Öƒ"] = "Õ“",
	["Ö„"] = "Õ”",
	["Ö…"] = "Õ•",
	["Ö†"] = "Õ–",
	["áµ½"] = "â±£",
	["á¸"] = "á¸€",
	["á¸ƒ"] = "á¸‚",
	["á¸…"] = "á¸„",
	["á¸‡"] = "á¸†",
	["á¸‰"] = "á¸ˆ",
	["á¸‹"] = "á¸Š",
	["á¸"] = "á¸Œ",
	["á¸"] = "á¸Ž",
	["á¸‘"] = "á¸",
	["á¸“"] = "á¸’",
	["á¸•"] = "á¸”",
	["á¸—"] = "á¸–",
	["á¸™"] = "á¸˜",
	["á¸›"] = "á¸š",
	["á¸"] = "á¸œ",
	["á¸Ÿ"] = "á¸ž",
	["á¸¡"] = "á¸ ",
	["á¸£"] = "á¸¢",
	["á¸¥"] = "á¸¤",
	["á¸§"] = "á¸¦",
	["á¸©"] = "á¸¨",
	["á¸«"] = "á¸ª",
	["á¸­"] = "á¸¬",
	["á¸¯"] = "á¸®",
	["á¸±"] = "á¸°",
	["á¸³"] = "á¸²",
	["á¸µ"] = "á¸´",
	["á¸·"] = "á¸¶",
	["á¸¹"] = "á¸¸",
	["á¸»"] = "á¸º",
	["á¸½"] = "á¸¼",
	["á¸¿"] = "á¸¾",
	["á¹"] = "á¹€",
	["á¹ƒ"] = "á¹‚",
	["á¹…"] = "á¹„",
	["á¹‡"] = "á¹†",
	["á¹‰"] = "á¹ˆ",
	["á¹‹"] = "á¹Š",
	["á¹"] = "á¹Œ",
	["á¹"] = "á¹Ž",
	["á¹‘"] = "á¹",
	["á¹“"] = "á¹’",
	["á¹•"] = "á¹”",
	["á¹—"] = "á¹–",
	["á¹™"] = "á¹˜",
	["á¹›"] = "á¹š",
	["á¹"] = "á¹œ",
	["á¹Ÿ"] = "á¹ž",
	["á¹¡"] = "á¹ ",
	["á¹£"] = "á¹¢",
	["á¹¥"] = "á¹¤",
	["á¹§"] = "á¹¦",
	["á¹©"] = "á¹¨",
	["á¹«"] = "á¹ª",
	["á¹­"] = "á¹¬",
	["á¹¯"] = "á¹®",
	["á¹±"] = "á¹°",
	["á¹³"] = "á¹²",
	["á¹µ"] = "á¹´",
	["á¹·"] = "á¹¶",
	["á¹¹"] = "á¹¸",
	["á¹»"] = "á¹º",
	["á¹½"] = "á¹¼",
	["á¹¿"] = "á¹¾",
	["áº"] = "áº€",
	["áºƒ"] = "áº‚",
	["áº…"] = "áº„",
	["áº‡"] = "áº†",
	["áº‰"] = "áºˆ",
	["áº‹"] = "áºŠ",
	["áº"] = "áºŒ",
	["áº"] = "áºŽ",
	["áº‘"] = "áº",
	["áº“"] = "áº’",
	["áº•"] = "áº”",
	["áº›"] = "á¹ ",
	["áº¡"] = "áº ",
	["áº£"] = "áº¢",
	["áº¥"] = "áº¤",
	["áº§"] = "áº¦",
	["áº©"] = "áº¨",
	["áº«"] = "áºª",
	["áº­"] = "áº¬",
	["áº¯"] = "áº®",
	["áº±"] = "áº°",
	["áº³"] = "áº²",
	["áºµ"] = "áº´",
	["áº·"] = "áº¶",
	["áº¹"] = "áº¸",
	["áº»"] = "áºº",
	["áº½"] = "áº¼",
	["áº¿"] = "áº¾",
	["á»"] = "á»€",
	["á»ƒ"] = "á»‚",
	["á»…"] = "á»„",
	["á»‡"] = "á»†",
	["á»‰"] = "á»ˆ",
	["á»‹"] = "á»Š",
	["á»"] = "á»Œ",
	["á»"] = "á»Ž",
	["á»‘"] = "á»",
	["á»“"] = "á»’",
	["á»•"] = "á»”",
	["á»—"] = "á»–",
	["á»™"] = "á»˜",
	["á»›"] = "á»š",
	["á»"] = "á»œ",
	["á»Ÿ"] = "á»ž",
	["á»¡"] = "á» ",
	["á»£"] = "á»¢",
	["á»¥"] = "á»¤",
	["á»§"] = "á»¦",
	["á»©"] = "á»¨",
	["á»«"] = "á»ª",
	["á»­"] = "á»¬",
	["á»¯"] = "á»®",
	["á»±"] = "á»°",
	["á»³"] = "á»²",
	["á»µ"] = "á»´",
	["á»·"] = "á»¶",
	["á»¹"] = "á»¸",
	["á¼€"] = "á¼ˆ",
	["á¼"] = "á¼‰",
	["á¼‚"] = "á¼Š",
	["á¼ƒ"] = "á¼‹",
	["á¼„"] = "á¼Œ",
	["á¼…"] = "á¼",
	["á¼†"] = "á¼Ž",
	["á¼‡"] = "á¼",
	["á¼"] = "á¼˜",
	["á¼‘"] = "á¼™",
	["á¼’"] = "á¼š",
	["á¼“"] = "á¼›",
	["á¼”"] = "á¼œ",
	["á¼•"] = "á¼",
	["á¼ "] = "á¼¨",
	["á¼¡"] = "á¼©",
	["á¼¢"] = "á¼ª",
	["á¼£"] = "á¼«",
	["á¼¤"] = "á¼¬",
	["á¼¥"] = "á¼­",
	["á¼¦"] = "á¼®",
	["á¼§"] = "á¼¯",
	["á¼°"] = "á¼¸",
	["á¼±"] = "á¼¹",
	["á¼²"] = "á¼º",
	["á¼³"] = "á¼»",
	["á¼´"] = "á¼¼",
	["á¼µ"] = "á¼½",
	["á¼¶"] = "á¼¾",
	["á¼·"] = "á¼¿",
	["á½€"] = "á½ˆ",
	["á½"] = "á½‰",
	["á½‚"] = "á½Š",
	["á½ƒ"] = "á½‹",
	["á½„"] = "á½Œ",
	["á½…"] = "á½",
	["á½‘"] = "á½™",
	["á½“"] = "á½›",
	["á½•"] = "á½",
	["á½—"] = "á½Ÿ",
	["á½ "] = "á½¨",
	["á½¡"] = "á½©",
	["á½¢"] = "á½ª",
	["á½£"] = "á½«",
	["á½¤"] = "á½¬",
	["á½¥"] = "á½­",
	["á½¦"] = "á½®",
	["á½§"] = "á½¯",
	["á½°"] = "á¾º",
	["á½±"] = "á¾»",
	["á½²"] = "á¿ˆ",
	["á½³"] = "á¿‰",
	["á½´"] = "á¿Š",
	["á½µ"] = "á¿‹",
	["á½¶"] = "á¿š",
	["á½·"] = "á¿›",
	["á½¸"] = "á¿¸",
	["á½¹"] = "á¿¹",
	["á½º"] = "á¿ª",
	["á½»"] = "á¿«",
	["á½¼"] = "á¿º",
	["á½½"] = "á¿»",
	["á¾€"] = "á¾ˆ",
	["á¾"] = "á¾‰",
	["á¾‚"] = "á¾Š",
	["á¾ƒ"] = "á¾‹",
	["á¾„"] = "á¾Œ",
	["á¾…"] = "á¾",
	["á¾†"] = "á¾Ž",
	["á¾‡"] = "á¾",
	["á¾"] = "á¾˜",
	["á¾‘"] = "á¾™",
	["á¾’"] = "á¾š",
	["á¾“"] = "á¾›",
	["á¾”"] = "á¾œ",
	["á¾•"] = "á¾",
	["á¾–"] = "á¾ž",
	["á¾—"] = "á¾Ÿ",
	["á¾ "] = "á¾¨",
	["á¾¡"] = "á¾©",
	["á¾¢"] = "á¾ª",
	["á¾£"] = "á¾«",
	["á¾¤"] = "á¾¬",
	["á¾¥"] = "á¾­",
	["á¾¦"] = "á¾®",
	["á¾§"] = "á¾¯",
	["á¾°"] = "á¾¸",
	["á¾±"] = "á¾¹",
	["á¾³"] = "á¾¼",
	["á¾¾"] = "Î™",
	["á¿ƒ"] = "á¿Œ",
	["á¿"] = "á¿˜",
	["á¿‘"] = "á¿™",
	["á¿ "] = "á¿¨",
	["á¿¡"] = "á¿©",
	["á¿¥"] = "á¿¬",
	["á¿³"] = "á¿¼",
	["â…Ž"] = "â„²",
	["â…°"] = "â… ",
	["â…±"] = "â…¡",
	["â…²"] = "â…¢",
	["â…³"] = "â…£",
	["â…´"] = "â…¤",
	["â…µ"] = "â…¥",
	["â…¶"] = "â…¦",
	["â…·"] = "â…§",
	["â…¸"] = "â…¨",
	["â…¹"] = "â…©",
	["â…º"] = "â…ª",
	["â…»"] = "â…«",
	["â…¼"] = "â…¬",
	["â…½"] = "â…­",
	["â…¾"] = "â…®",
	["â…¿"] = "â…¯",
	["â†„"] = "â†ƒ",
	["â“"] = "â’¶",
	["â“‘"] = "â’·",
	["â“’"] = "â’¸",
	["â““"] = "â’¹",
	["â“”"] = "â’º",
	["â“•"] = "â’»",
	["â“–"] = "â’¼",
	["â“—"] = "â’½",
	["â“˜"] = "â’¾",
	["â“™"] = "â’¿",
	["â“š"] = "â“€",
	["â“›"] = "â“",
	["â“œ"] = "â“‚",
	["â“"] = "â“ƒ",
	["â“ž"] = "â“„",
	["â“Ÿ"] = "â“…",
	["â“ "] = "â“†",
	["â“¡"] = "â“‡",
	["â“¢"] = "â“ˆ",
	["â“£"] = "â“‰",
	["â“¤"] = "â“Š",
	["â“¥"] = "â“‹",
	["â“¦"] = "â“Œ",
	["â“§"] = "â“",
	["â“¨"] = "â“Ž",
	["â“©"] = "â“",
	["â°°"] = "â°€",
	["â°±"] = "â°",
	["â°²"] = "â°‚",
	["â°³"] = "â°ƒ",
	["â°´"] = "â°„",
	["â°µ"] = "â°…",
	["â°¶"] = "â°†",
	["â°·"] = "â°‡",
	["â°¸"] = "â°ˆ",
	["â°¹"] = "â°‰",
	["â°º"] = "â°Š",
	["â°»"] = "â°‹",
	["â°¼"] = "â°Œ",
	["â°½"] = "â°",
	["â°¾"] = "â°Ž",
	["â°¿"] = "â°",
	["â±€"] = "â°",
	["â±"] = "â°‘",
	["â±‚"] = "â°’",
	["â±ƒ"] = "â°“",
	["â±„"] = "â°”",
	["â±…"] = "â°•",
	["â±†"] = "â°–",
	["â±‡"] = "â°—",
	["â±ˆ"] = "â°˜",
	["â±‰"] = "â°™",
	["â±Š"] = "â°š",
	["â±‹"] = "â°›",
	["â±Œ"] = "â°œ",
	["â±"] = "â°",
	["â±Ž"] = "â°ž",
	["â±"] = "â°Ÿ",
	["â±"] = "â° ",
	["â±‘"] = "â°¡",
	["â±’"] = "â°¢",
	["â±“"] = "â°£",
	["â±”"] = "â°¤",
	["â±•"] = "â°¥",
	["â±–"] = "â°¦",
	["â±—"] = "â°§",
	["â±˜"] = "â°¨",
	["â±™"] = "â°©",
	["â±š"] = "â°ª",
	["â±›"] = "â°«",
	["â±œ"] = "â°¬",
	["â±"] = "â°­",
	["â±ž"] = "â°®",
	["â±¡"] = "â± ",
	["â±¥"] = "Èº",
	["â±¦"] = "È¾",
	["â±¨"] = "â±§",
	["â±ª"] = "â±©",
	["â±¬"] = "â±«",
	["â±¶"] = "â±µ",
	["â²"] = "â²€",
	["â²ƒ"] = "â²‚",
	["â²…"] = "â²„",
	["â²‡"] = "â²†",
	["â²‰"] = "â²ˆ",
	["â²‹"] = "â²Š",
	["â²"] = "â²Œ",
	["â²"] = "â²Ž",
	["â²‘"] = "â²",
	["â²“"] = "â²’",
	["â²•"] = "â²”",
	["â²—"] = "â²–",
	["â²™"] = "â²˜",
	["â²›"] = "â²š",
	["â²"] = "â²œ",
	["â²Ÿ"] = "â²ž",
	["â²¡"] = "â² ",
	["â²£"] = "â²¢",
	["â²¥"] = "â²¤",
	["â²§"] = "â²¦",
	["â²©"] = "â²¨",
	["â²«"] = "â²ª",
	["â²­"] = "â²¬",
	["â²¯"] = "â²®",
	["â²±"] = "â²°",
	["â²³"] = "â²²",
	["â²µ"] = "â²´",
	["â²·"] = "â²¶",
	["â²¹"] = "â²¸",
	["â²»"] = "â²º",
	["â²½"] = "â²¼",
	["â²¿"] = "â²¾",
	["â³"] = "â³€",
	["â³ƒ"] = "â³‚",
	["â³…"] = "â³„",
	["â³‡"] = "â³†",
	["â³‰"] = "â³ˆ",
	["â³‹"] = "â³Š",
	["â³"] = "â³Œ",
	["â³"] = "â³Ž",
	["â³‘"] = "â³",
	["â³“"] = "â³’",
	["â³•"] = "â³”",
	["â³—"] = "â³–",
	["â³™"] = "â³˜",
	["â³›"] = "â³š",
	["â³"] = "â³œ",
	["â³Ÿ"] = "â³ž",
	["â³¡"] = "â³ ",
	["â³£"] = "â³¢",
	["â´€"] = "á‚ ",
	["â´"] = "á‚¡",
	["â´‚"] = "á‚¢",
	["â´ƒ"] = "á‚£",
	["â´„"] = "á‚¤",
	["â´…"] = "á‚¥",
	["â´†"] = "á‚¦",
	["â´‡"] = "á‚§",
	["â´ˆ"] = "á‚¨",
	["â´‰"] = "á‚©",
	["â´Š"] = "á‚ª",
	["â´‹"] = "á‚«",
	["â´Œ"] = "á‚¬",
	["â´"] = "á‚­",
	["â´Ž"] = "á‚®",
	["â´"] = "á‚¯",
	["â´"] = "á‚°",
	["â´‘"] = "á‚±",
	["â´’"] = "á‚²",
	["â´“"] = "á‚³",
	["â´”"] = "á‚´",
	["â´•"] = "á‚µ",
	["â´–"] = "á‚¶",
	["â´—"] = "á‚·",
	["â´˜"] = "á‚¸",
	["â´™"] = "á‚¹",
	["â´š"] = "á‚º",
	["â´›"] = "á‚»",
	["â´œ"] = "á‚¼",
	["â´"] = "á‚½",
	["â´ž"] = "á‚¾",
	["â´Ÿ"] = "á‚¿",
	["â´ "] = "áƒ€",
	["â´¡"] = "áƒ",
	["â´¢"] = "áƒ‚",
	["â´£"] = "áƒƒ",
	["â´¤"] = "áƒ„",
	["â´¥"] = "áƒ…",
	["ï½"] = "ï¼¡",
	["ï½‚"] = "ï¼¢",
	["ï½ƒ"] = "ï¼£",
	["ï½„"] = "ï¼¤",
	["ï½…"] = "ï¼¥",
	["ï½†"] = "ï¼¦",
	["ï½‡"] = "ï¼§",
	["ï½ˆ"] = "ï¼¨",
	["ï½‰"] = "ï¼©",
	["ï½Š"] = "ï¼ª",
	["ï½‹"] = "ï¼«",
	["ï½Œ"] = "ï¼¬",
	["ï½"] = "ï¼­",
	["ï½Ž"] = "ï¼®",
	["ï½"] = "ï¼¯",
	["ï½"] = "ï¼°",
	["ï½‘"] = "ï¼±",
	["ï½’"] = "ï¼²",
	["ï½“"] = "ï¼³",
	["ï½”"] = "ï¼´",
	["ï½•"] = "ï¼µ",
	["ï½–"] = "ï¼¶",
	["ï½—"] = "ï¼·",
	["ï½˜"] = "ï¼¸",
	["ï½™"] = "ï¼¹",
	["ï½š"] = "ï¼º",
	["ð¨"] = "ð€",
	["ð©"] = "ð",
	["ðª"] = "ð‚",
	["ð«"] = "ðƒ",
	["ð¬"] = "ð„",
	["ð­"] = "ð…",
	["ð®"] = "ð†",
	["ð¯"] = "ð‡",
	["ð°"] = "ðˆ",
	["ð±"] = "ð‰",
	["ð²"] = "ðŠ",
	["ð³"] = "ð‹",
	["ð´"] = "ðŒ",
	["ðµ"] = "ð",
	["ð¶"] = "ðŽ",
	["ð·"] = "ð",
	["ð¸"] = "ð",
	["ð¹"] = "ð‘",
	["ðº"] = "ð’",
	["ð»"] = "ð“",
	["ð¼"] = "ð”",
	["ð½"] = "ð•",
	["ð¾"] = "ð–",
	["ð¿"] = "ð—",
	["ð‘€"] = "ð˜",
	["ð‘"] = "ð™",
	["ð‘‚"] = "ðš",
	["ð‘ƒ"] = "ð›",
	["ð‘„"] = "ðœ",
	["ð‘…"] = "ð",
	["ð‘†"] = "ðž",
	["ð‘‡"] = "ðŸ",
	["ð‘ˆ"] = "ð ",
	["ð‘‰"] = "ð¡",
	["ð‘Š"] = "ð¢",
	["ð‘‹"] = "ð£",
	["ð‘Œ"] = "ð¤",
	["ð‘"] = "ð¥",
	["ð‘Ž"] = "ð¦",
	["ð‘"] = "ð§",
}

local UTF8UpperToLower = {
	["A"] = "a",
	["B"] = "b",
	["C"] = "c",
	["D"] = "d",
	["E"] = "e",
	["F"] = "f",
	["G"] = "g",
	["H"] = "h",
	["I"] = "i",
	["J"] = "j",
	["K"] = "k",
	["L"] = "l",
	["M"] = "m",
	["N"] = "n",
	["O"] = "o",
	["P"] = "p",
	["Q"] = "q",
	["R"] = "r",
	["S"] = "s",
	["T"] = "t",
	["U"] = "u",
	["V"] = "v",
	["W"] = "w",
	["X"] = "x",
	["Y"] = "y",
	["Z"] = "z",
	["Ã€"] = "Ã ",
	["Ã"] = "Ã¡",
	["Ã‚"] = "Ã¢",
	["Ãƒ"] = "Ã£",
	["Ã„"] = "Ã¤",
	["Ã…"] = "Ã¥",
	["Ã†"] = "Ã¦",
	["Ã‡"] = "Ã§",
	["Ãˆ"] = "Ã¨",
	["Ã‰"] = "Ã©",
	["ÃŠ"] = "Ãª",
	["Ã‹"] = "Ã«",
	["ÃŒ"] = "Ã¬",
	["Ã"] = "Ã­",
	["ÃŽ"] = "Ã®",
	["Ã"] = "Ã¯",
	["Ã"] = "Ã°",
	["Ã‘"] = "Ã±",
	["Ã’"] = "Ã²",
	["Ã“"] = "Ã³",
	["Ã”"] = "Ã´",
	["Ã•"] = "Ãµ",
	["Ã–"] = "Ã¶",
	["Ã˜"] = "Ã¸",
	["Ã™"] = "Ã¹",
	["Ãš"] = "Ãº",
	["Ã›"] = "Ã»",
	["Ãœ"] = "Ã¼",
	["Ã"] = "Ã½",
	["Ãž"] = "Ã¾",
	["Ä€"] = "Ä",
	["Ä‚"] = "Äƒ",
	["Ä„"] = "Ä…",
	["Ä†"] = "Ä‡",
	["Äˆ"] = "Ä‰",
	["ÄŠ"] = "Ä‹",
	["ÄŒ"] = "Ä",
	["ÄŽ"] = "Ä",
	["Ä"] = "Ä‘",
	["Ä’"] = "Ä“",
	["Ä”"] = "Ä•",
	["Ä–"] = "Ä—",
	["Ä˜"] = "Ä™",
	["Äš"] = "Ä›",
	["Äœ"] = "Ä",
	["Äž"] = "ÄŸ",
	["Ä "] = "Ä¡",
	["Ä¢"] = "Ä£",
	["Ä¤"] = "Ä¥",
	["Ä¦"] = "Ä§",
	["Ä¨"] = "Ä©",
	["Äª"] = "Ä«",
	["Ä¬"] = "Ä­",
	["Ä®"] = "Ä¯",
	["Ä°"] = "i",
	["Ä²"] = "Ä³",
	["Ä´"] = "Äµ",
	["Ä¶"] = "Ä·",
	["Ä¹"] = "Äº",
	["Ä»"] = "Ä¼",
	["Ä½"] = "Ä¾",
	["Ä¿"] = "Å€",
	["Å"] = "Å‚",
	["Åƒ"] = "Å„",
	["Å…"] = "Å†",
	["Å‡"] = "Åˆ",
	["ÅŠ"] = "Å‹",
	["ÅŒ"] = "Å",
	["ÅŽ"] = "Å",
	["Å"] = "Å‘",
	["Å’"] = "Å“",
	["Å”"] = "Å•",
	["Å–"] = "Å—",
	["Å˜"] = "Å™",
	["Åš"] = "Å›",
	["Åœ"] = "Å",
	["Åž"] = "ÅŸ",
	["Å "] = "Å¡",
	["Å¢"] = "Å£",
	["Å¤"] = "Å¥",
	["Å¦"] = "Å§",
	["Å¨"] = "Å©",
	["Åª"] = "Å«",
	["Å¬"] = "Å­",
	["Å®"] = "Å¯",
	["Å°"] = "Å±",
	["Å²"] = "Å³",
	["Å´"] = "Åµ",
	["Å¶"] = "Å·",
	["Å¸"] = "Ã¿",
	["Å¹"] = "Åº",
	["Å»"] = "Å¼",
	["Å½"] = "Å¾",
	["Æ"] = "É“",
	["Æ‚"] = "Æƒ",
	["Æ„"] = "Æ…",
	["Æ†"] = "É”",
	["Æ‡"] = "Æˆ",
	["Æ‰"] = "É–",
	["ÆŠ"] = "É—",
	["Æ‹"] = "ÆŒ",
	["ÆŽ"] = "Ç",
	["Æ"] = "É™",
	["Æ"] = "É›",
	["Æ‘"] = "Æ’",
	["Æ“"] = "É ",
	["Æ”"] = "É£",
	["Æ–"] = "É©",
	["Æ—"] = "É¨",
	["Æ˜"] = "Æ™",
	["Æœ"] = "É¯",
	["Æ"] = "É²",
	["ÆŸ"] = "Éµ",
	["Æ "] = "Æ¡",
	["Æ¢"] = "Æ£",
	["Æ¤"] = "Æ¥",
	["Æ¦"] = "Ê€",
	["Æ§"] = "Æ¨",
	["Æ©"] = "Êƒ",
	["Æ¬"] = "Æ­",
	["Æ®"] = "Êˆ",
	["Æ¯"] = "Æ°",
	["Æ±"] = "ÊŠ",
	["Æ²"] = "Ê‹",
	["Æ³"] = "Æ´",
	["Æµ"] = "Æ¶",
	["Æ·"] = "Ê’",
	["Æ¸"] = "Æ¹",
	["Æ¼"] = "Æ½",
	["Ç„"] = "Ç†",
	["Ç…"] = "Ç†",
	["Ç‡"] = "Ç‰",
	["Çˆ"] = "Ç‰",
	["ÇŠ"] = "ÇŒ",
	["Ç‹"] = "ÇŒ",
	["Ç"] = "ÇŽ",
	["Ç"] = "Ç",
	["Ç‘"] = "Ç’",
	["Ç“"] = "Ç”",
	["Ç•"] = "Ç–",
	["Ç—"] = "Ç˜",
	["Ç™"] = "Çš",
	["Ç›"] = "Çœ",
	["Çž"] = "ÇŸ",
	["Ç "] = "Ç¡",
	["Ç¢"] = "Ç£",
	["Ç¤"] = "Ç¥",
	["Ç¦"] = "Ç§",
	["Ç¨"] = "Ç©",
	["Çª"] = "Ç«",
	["Ç¬"] = "Ç­",
	["Ç®"] = "Ç¯",
	["Ç±"] = "Ç³",
	["Ç²"] = "Ç³",
	["Ç´"] = "Çµ",
	["Ç¶"] = "Æ•",
	["Ç·"] = "Æ¿",
	["Ç¸"] = "Ç¹",
	["Çº"] = "Ç»",
	["Ç¼"] = "Ç½",
	["Ç¾"] = "Ç¿",
	["È€"] = "È",
	["È‚"] = "Èƒ",
	["È„"] = "È…",
	["È†"] = "È‡",
	["Èˆ"] = "È‰",
	["ÈŠ"] = "È‹",
	["ÈŒ"] = "È",
	["ÈŽ"] = "È",
	["È"] = "È‘",
	["È’"] = "È“",
	["È”"] = "È•",
	["È–"] = "È—",
	["È˜"] = "È™",
	["Èš"] = "È›",
	["Èœ"] = "È",
	["Èž"] = "ÈŸ",
	["È "] = "Æž",
	["È¢"] = "È£",
	["È¤"] = "È¥",
	["È¦"] = "È§",
	["È¨"] = "È©",
	["Èª"] = "È«",
	["È¬"] = "È­",
	["È®"] = "È¯",
	["È°"] = "È±",
	["È²"] = "È³",
	["Èº"] = "â±¥",
	["È»"] = "È¼",
	["È½"] = "Æš",
	["È¾"] = "â±¦",
	["É"] = "É‚",
	["Éƒ"] = "Æ€",
	["É„"] = "Ê‰",
	["É…"] = "ÊŒ",
	["É†"] = "É‡",
	["Éˆ"] = "É‰",
	["ÉŠ"] = "É‹",
	["ÉŒ"] = "É",
	["ÉŽ"] = "É",
	["Î†"] = "Î¬",
	["Îˆ"] = "Î­",
	["Î‰"] = "Î®",
	["ÎŠ"] = "Î¯",
	["ÎŒ"] = "ÏŒ",
	["ÎŽ"] = "Ï",
	["Î"] = "ÏŽ",
	["Î‘"] = "Î±",
	["Î’"] = "Î²",
	["Î“"] = "Î³",
	["Î”"] = "Î´",
	["Î•"] = "Îµ",
	["Î–"] = "Î¶",
	["Î—"] = "Î·",
	["Î˜"] = "Î¸",
	["Î™"] = "Î¹",
	["Îš"] = "Îº",
	["Î›"] = "Î»",
	["Îœ"] = "Î¼",
	["Î"] = "Î½",
	["Îž"] = "Î¾",
	["ÎŸ"] = "Î¿",
	["Î "] = "Ï€",
	["Î¡"] = "Ï",
	["Î£"] = "Ïƒ",
	["Î¤"] = "Ï„",
	["Î¥"] = "Ï…",
	["Î¦"] = "Ï†",
	["Î§"] = "Ï‡",
	["Î¨"] = "Ïˆ",
	["Î©"] = "Ï‰",
	["Îª"] = "ÏŠ",
	["Î«"] = "Ï‹",
	["Ï˜"] = "Ï™",
	["Ïš"] = "Ï›",
	["Ïœ"] = "Ï",
	["Ïž"] = "ÏŸ",
	["Ï "] = "Ï¡",
	["Ï¢"] = "Ï£",
	["Ï¤"] = "Ï¥",
	["Ï¦"] = "Ï§",
	["Ï¨"] = "Ï©",
	["Ïª"] = "Ï«",
	["Ï¬"] = "Ï­",
	["Ï®"] = "Ï¯",
	["Ï´"] = "Î¸",
	["Ï·"] = "Ï¸",
	["Ï¹"] = "Ï²",
	["Ïº"] = "Ï»",
	["Ï½"] = "Í»",
	["Ï¾"] = "Í¼",
	["Ï¿"] = "Í½",
	["Ð€"] = "Ñ",
	["Ð"] = "Ñ‘",
	["Ð‚"] = "Ñ’",
	["Ðƒ"] = "Ñ“",
	["Ð„"] = "Ñ”",
	["Ð…"] = "Ñ•",
	["Ð†"] = "Ñ–",
	["Ð‡"] = "Ñ—",
	["Ðˆ"] = "Ñ˜",
	["Ð‰"] = "Ñ™",
	["ÐŠ"] = "Ñš",
	["Ð‹"] = "Ñ›",
	["ÐŒ"] = "Ñœ",
	["Ð"] = "Ñ",
	["ÐŽ"] = "Ñž",
	["Ð"] = "ÑŸ",
	["Ð"] = "Ð°",
	["Ð‘"] = "Ð±",
	["Ð’"] = "Ð²",
	["Ð“"] = "Ð³",
	["Ð”"] = "Ð´",
	["Ð•"] = "Ðµ",
	["Ð–"] = "Ð¶",
	["Ð—"] = "Ð·",
	["Ð˜"] = "Ð¸",
	["Ð™"] = "Ð¹",
	["Ðš"] = "Ðº",
	["Ð›"] = "Ð»",
	["Ðœ"] = "Ð¼",
	["Ð"] = "Ð½",
	["Ðž"] = "Ð¾",
	["ÐŸ"] = "Ð¿",
	["Ð "] = "Ñ€",
	["Ð¡"] = "Ñ",
	["Ð¢"] = "Ñ‚",
	["Ð£"] = "Ñƒ",
	["Ð¤"] = "Ñ„",
	["Ð¥"] = "Ñ…",
	["Ð¦"] = "Ñ†",
	["Ð§"] = "Ñ‡",
	["Ð¨"] = "Ñˆ",
	["Ð©"] = "Ñ‰",
	["Ðª"] = "ÑŠ",
	["Ð«"] = "Ñ‹",
	["Ð¬"] = "ÑŒ",
	["Ð­"] = "Ñ",
	["Ð®"] = "ÑŽ",
	["Ð¯"] = "Ñ",
	["Ñ "] = "Ñ¡",
	["Ñ¢"] = "Ñ£",
	["Ñ¤"] = "Ñ¥",
	["Ñ¦"] = "Ñ§",
	["Ñ¨"] = "Ñ©",
	["Ñª"] = "Ñ«",
	["Ñ¬"] = "Ñ­",
	["Ñ®"] = "Ñ¯",
	["Ñ°"] = "Ñ±",
	["Ñ²"] = "Ñ³",
	["Ñ´"] = "Ñµ",
	["Ñ¶"] = "Ñ·",
	["Ñ¸"] = "Ñ¹",
	["Ñº"] = "Ñ»",
	["Ñ¼"] = "Ñ½",
	["Ñ¾"] = "Ñ¿",
	["Ò€"] = "Ò",
	["ÒŠ"] = "Ò‹",
	["ÒŒ"] = "Ò",
	["ÒŽ"] = "Ò",
	["Ò"] = "Ò‘",
	["Ò’"] = "Ò“",
	["Ò”"] = "Ò•",
	["Ò–"] = "Ò—",
	["Ò˜"] = "Ò™",
	["Òš"] = "Ò›",
	["Òœ"] = "Ò",
	["Òž"] = "ÒŸ",
	["Ò "] = "Ò¡",
	["Ò¢"] = "Ò£",
	["Ò¤"] = "Ò¥",
	["Ò¦"] = "Ò§",
	["Ò¨"] = "Ò©",
	["Òª"] = "Ò«",
	["Ò¬"] = "Ò­",
	["Ò®"] = "Ò¯",
	["Ò°"] = "Ò±",
	["Ò²"] = "Ò³",
	["Ò´"] = "Òµ",
	["Ò¶"] = "Ò·",
	["Ò¸"] = "Ò¹",
	["Òº"] = "Ò»",
	["Ò¼"] = "Ò½",
	["Ò¾"] = "Ò¿",
	["Ó€"] = "Ó",
	["Ó"] = "Ó‚",
	["Óƒ"] = "Ó„",
	["Ó…"] = "Ó†",
	["Ó‡"] = "Óˆ",
	["Ó‰"] = "ÓŠ",
	["Ó‹"] = "ÓŒ",
	["Ó"] = "ÓŽ",
	["Ó"] = "Ó‘",
	["Ó’"] = "Ó“",
	["Ó”"] = "Ó•",
	["Ó–"] = "Ó—",
	["Ó˜"] = "Ó™",
	["Óš"] = "Ó›",
	["Óœ"] = "Ó",
	["Óž"] = "ÓŸ",
	["Ó "] = "Ó¡",
	["Ó¢"] = "Ó£",
	["Ó¤"] = "Ó¥",
	["Ó¦"] = "Ó§",
	["Ó¨"] = "Ó©",
	["Óª"] = "Ó«",
	["Ó¬"] = "Ó­",
	["Ó®"] = "Ó¯",
	["Ó°"] = "Ó±",
	["Ó²"] = "Ó³",
	["Ó´"] = "Óµ",
	["Ó¶"] = "Ó·",
	["Ó¸"] = "Ó¹",
	["Óº"] = "Ó»",
	["Ó¼"] = "Ó½",
	["Ó¾"] = "Ó¿",
	["Ô€"] = "Ô",
	["Ô‚"] = "Ôƒ",
	["Ô„"] = "Ô…",
	["Ô†"] = "Ô‡",
	["Ôˆ"] = "Ô‰",
	["ÔŠ"] = "Ô‹",
	["ÔŒ"] = "Ô",
	["ÔŽ"] = "Ô",
	["Ô"] = "Ô‘",
	["Ô’"] = "Ô“",
	["Ô±"] = "Õ¡",
	["Ô²"] = "Õ¢",
	["Ô³"] = "Õ£",
	["Ô´"] = "Õ¤",
	["Ôµ"] = "Õ¥",
	["Ô¶"] = "Õ¦",
	["Ô·"] = "Õ§",
	["Ô¸"] = "Õ¨",
	["Ô¹"] = "Õ©",
	["Ôº"] = "Õª",
	["Ô»"] = "Õ«",
	["Ô¼"] = "Õ¬",
	["Ô½"] = "Õ­",
	["Ô¾"] = "Õ®",
	["Ô¿"] = "Õ¯",
	["Õ€"] = "Õ°",
	["Õ"] = "Õ±",
	["Õ‚"] = "Õ²",
	["Õƒ"] = "Õ³",
	["Õ„"] = "Õ´",
	["Õ…"] = "Õµ",
	["Õ†"] = "Õ¶",
	["Õ‡"] = "Õ·",
	["Õˆ"] = "Õ¸",
	["Õ‰"] = "Õ¹",
	["ÕŠ"] = "Õº",
	["Õ‹"] = "Õ»",
	["ÕŒ"] = "Õ¼",
	["Õ"] = "Õ½",
	["ÕŽ"] = "Õ¾",
	["Õ"] = "Õ¿",
	["Õ"] = "Ö€",
	["Õ‘"] = "Ö",
	["Õ’"] = "Ö‚",
	["Õ“"] = "Öƒ",
	["Õ”"] = "Ö„",
	["Õ•"] = "Ö…",
	["Õ–"] = "Ö†",
	["á‚ "] = "â´€",
	["á‚¡"] = "â´",
	["á‚¢"] = "â´‚",
	["á‚£"] = "â´ƒ",
	["á‚¤"] = "â´„",
	["á‚¥"] = "â´…",
	["á‚¦"] = "â´†",
	["á‚§"] = "â´‡",
	["á‚¨"] = "â´ˆ",
	["á‚©"] = "â´‰",
	["á‚ª"] = "â´Š",
	["á‚«"] = "â´‹",
	["á‚¬"] = "â´Œ",
	["á‚­"] = "â´",
	["á‚®"] = "â´Ž",
	["á‚¯"] = "â´",
	["á‚°"] = "â´",
	["á‚±"] = "â´‘",
	["á‚²"] = "â´’",
	["á‚³"] = "â´“",
	["á‚´"] = "â´”",
	["á‚µ"] = "â´•",
	["á‚¶"] = "â´–",
	["á‚·"] = "â´—",
	["á‚¸"] = "â´˜",
	["á‚¹"] = "â´™",
	["á‚º"] = "â´š",
	["á‚»"] = "â´›",
	["á‚¼"] = "â´œ",
	["á‚½"] = "â´",
	["á‚¾"] = "â´ž",
	["á‚¿"] = "â´Ÿ",
	["áƒ€"] = "â´ ",
	["áƒ"] = "â´¡",
	["áƒ‚"] = "â´¢",
	["áƒƒ"] = "â´£",
	["áƒ„"] = "â´¤",
	["áƒ…"] = "â´¥",
	["á¸€"] = "á¸",
	["á¸‚"] = "á¸ƒ",
	["á¸„"] = "á¸…",
	["á¸†"] = "á¸‡",
	["á¸ˆ"] = "á¸‰",
	["á¸Š"] = "á¸‹",
	["á¸Œ"] = "á¸",
	["á¸Ž"] = "á¸",
	["á¸"] = "á¸‘",
	["á¸’"] = "á¸“",
	["á¸”"] = "á¸•",
	["á¸–"] = "á¸—",
	["á¸˜"] = "á¸™",
	["á¸š"] = "á¸›",
	["á¸œ"] = "á¸",
	["á¸ž"] = "á¸Ÿ",
	["á¸ "] = "á¸¡",
	["á¸¢"] = "á¸£",
	["á¸¤"] = "á¸¥",
	["á¸¦"] = "á¸§",
	["á¸¨"] = "á¸©",
	["á¸ª"] = "á¸«",
	["á¸¬"] = "á¸­",
	["á¸®"] = "á¸¯",
	["á¸°"] = "á¸±",
	["á¸²"] = "á¸³",
	["á¸´"] = "á¸µ",
	["á¸¶"] = "á¸·",
	["á¸¸"] = "á¸¹",
	["á¸º"] = "á¸»",
	["á¸¼"] = "á¸½",
	["á¸¾"] = "á¸¿",
	["á¹€"] = "á¹",
	["á¹‚"] = "á¹ƒ",
	["á¹„"] = "á¹…",
	["á¹†"] = "á¹‡",
	["á¹ˆ"] = "á¹‰",
	["á¹Š"] = "á¹‹",
	["á¹Œ"] = "á¹",
	["á¹Ž"] = "á¹",
	["á¹"] = "á¹‘",
	["á¹’"] = "á¹“",
	["á¹”"] = "á¹•",
	["á¹–"] = "á¹—",
	["á¹˜"] = "á¹™",
	["á¹š"] = "á¹›",
	["á¹œ"] = "á¹",
	["á¹ž"] = "á¹Ÿ",
	["á¹ "] = "á¹¡",
	["á¹¢"] = "á¹£",
	["á¹¤"] = "á¹¥",
	["á¹¦"] = "á¹§",
	["á¹¨"] = "á¹©",
	["á¹ª"] = "á¹«",
	["á¹¬"] = "á¹­",
	["á¹®"] = "á¹¯",
	["á¹°"] = "á¹±",
	["á¹²"] = "á¹³",
	["á¹´"] = "á¹µ",
	["á¹¶"] = "á¹·",
	["á¹¸"] = "á¹¹",
	["á¹º"] = "á¹»",
	["á¹¼"] = "á¹½",
	["á¹¾"] = "á¹¿",
	["áº€"] = "áº",
	["áº‚"] = "áºƒ",
	["áº„"] = "áº…",
	["áº†"] = "áº‡",
	["áºˆ"] = "áº‰",
	["áºŠ"] = "áº‹",
	["áºŒ"] = "áº",
	["áºŽ"] = "áº",
	["áº"] = "áº‘",
	["áº’"] = "áº“",
	["áº”"] = "áº•",
	["áº "] = "áº¡",
	["áº¢"] = "áº£",
	["áº¤"] = "áº¥",
	["áº¦"] = "áº§",
	["áº¨"] = "áº©",
	["áºª"] = "áº«",
	["áº¬"] = "áº­",
	["áº®"] = "áº¯",
	["áº°"] = "áº±",
	["áº²"] = "áº³",
	["áº´"] = "áºµ",
	["áº¶"] = "áº·",
	["áº¸"] = "áº¹",
	["áºº"] = "áº»",
	["áº¼"] = "áº½",
	["áº¾"] = "áº¿",
	["á»€"] = "á»",
	["á»‚"] = "á»ƒ",
	["á»„"] = "á»…",
	["á»†"] = "á»‡",
	["á»ˆ"] = "á»‰",
	["á»Š"] = "á»‹",
	["á»Œ"] = "á»",
	["á»Ž"] = "á»",
	["á»"] = "á»‘",
	["á»’"] = "á»“",
	["á»”"] = "á»•",
	["á»–"] = "á»—",
	["á»˜"] = "á»™",
	["á»š"] = "á»›",
	["á»œ"] = "á»",
	["á»ž"] = "á»Ÿ",
	["á» "] = "á»¡",
	["á»¢"] = "á»£",
	["á»¤"] = "á»¥",
	["á»¦"] = "á»§",
	["á»¨"] = "á»©",
	["á»ª"] = "á»«",
	["á»¬"] = "á»­",
	["á»®"] = "á»¯",
	["á»°"] = "á»±",
	["á»²"] = "á»³",
	["á»´"] = "á»µ",
	["á»¶"] = "á»·",
	["á»¸"] = "á»¹",
	["á¼ˆ"] = "á¼€",
	["á¼‰"] = "á¼",
	["á¼Š"] = "á¼‚",
	["á¼‹"] = "á¼ƒ",
	["á¼Œ"] = "á¼„",
	["á¼"] = "á¼…",
	["á¼Ž"] = "á¼†",
	["á¼"] = "á¼‡",
	["á¼˜"] = "á¼",
	["á¼™"] = "á¼‘",
	["á¼š"] = "á¼’",
	["á¼›"] = "á¼“",
	["á¼œ"] = "á¼”",
	["á¼"] = "á¼•",
	["á¼¨"] = "á¼ ",
	["á¼©"] = "á¼¡",
	["á¼ª"] = "á¼¢",
	["á¼«"] = "á¼£",
	["á¼¬"] = "á¼¤",
	["á¼­"] = "á¼¥",
	["á¼®"] = "á¼¦",
	["á¼¯"] = "á¼§",
	["á¼¸"] = "á¼°",
	["á¼¹"] = "á¼±",
	["á¼º"] = "á¼²",
	["á¼»"] = "á¼³",
	["á¼¼"] = "á¼´",
	["á¼½"] = "á¼µ",
	["á¼¾"] = "á¼¶",
	["á¼¿"] = "á¼·",
	["á½ˆ"] = "á½€",
	["á½‰"] = "á½",
	["á½Š"] = "á½‚",
	["á½‹"] = "á½ƒ",
	["á½Œ"] = "á½„",
	["á½"] = "á½…",
	["á½™"] = "á½‘",
	["á½›"] = "á½“",
	["á½"] = "á½•",
	["á½Ÿ"] = "á½—",
	["á½¨"] = "á½ ",
	["á½©"] = "á½¡",
	["á½ª"] = "á½¢",
	["á½«"] = "á½£",
	["á½¬"] = "á½¤",
	["á½­"] = "á½¥",
	["á½®"] = "á½¦",
	["á½¯"] = "á½§",
	["á¾ˆ"] = "á¾€",
	["á¾‰"] = "á¾",
	["á¾Š"] = "á¾‚",
	["á¾‹"] = "á¾ƒ",
	["á¾Œ"] = "á¾„",
	["á¾"] = "á¾…",
	["á¾Ž"] = "á¾†",
	["á¾"] = "á¾‡",
	["á¾˜"] = "á¾",
	["á¾™"] = "á¾‘",
	["á¾š"] = "á¾’",
	["á¾›"] = "á¾“",
	["á¾œ"] = "á¾”",
	["á¾"] = "á¾•",
	["á¾ž"] = "á¾–",
	["á¾Ÿ"] = "á¾—",
	["á¾¨"] = "á¾ ",
	["á¾©"] = "á¾¡",
	["á¾ª"] = "á¾¢",
	["á¾«"] = "á¾£",
	["á¾¬"] = "á¾¤",
	["á¾­"] = "á¾¥",
	["á¾®"] = "á¾¦",
	["á¾¯"] = "á¾§",
	["á¾¸"] = "á¾°",
	["á¾¹"] = "á¾±",
	["á¾º"] = "á½°",
	["á¾»"] = "á½±",
	["á¾¼"] = "á¾³",
	["á¿ˆ"] = "á½²",
	["á¿‰"] = "á½³",
	["á¿Š"] = "á½´",
	["á¿‹"] = "á½µ",
	["á¿Œ"] = "á¿ƒ",
	["á¿˜"] = "á¿",
	["á¿™"] = "á¿‘",
	["á¿š"] = "á½¶",
	["á¿›"] = "á½·",
	["á¿¨"] = "á¿ ",
	["á¿©"] = "á¿¡",
	["á¿ª"] = "á½º",
	["á¿«"] = "á½»",
	["á¿¬"] = "á¿¥",
	["á¿¸"] = "á½¸",
	["á¿¹"] = "á½¹",
	["á¿º"] = "á½¼",
	["á¿»"] = "á½½",
	["á¿¼"] = "á¿³",
	["â„¦"] = "Ï‰",
	["â„ª"] = "k",
	["â„«"] = "Ã¥",
	["â„²"] = "â…Ž",
	["â… "] = "â…°",
	["â…¡"] = "â…±",
	["â…¢"] = "â…²",
	["â…£"] = "â…³",
	["â…¤"] = "â…´",
	["â…¥"] = "â…µ",
	["â…¦"] = "â…¶",
	["â…§"] = "â…·",
	["â…¨"] = "â…¸",
	["â…©"] = "â…¹",
	["â…ª"] = "â…º",
	["â…«"] = "â…»",
	["â…¬"] = "â…¼",
	["â…­"] = "â…½",
	["â…®"] = "â…¾",
	["â…¯"] = "â…¿",
	["â†ƒ"] = "â†„",
	["â’¶"] = "â“",
	["â’·"] = "â“‘",
	["â’¸"] = "â“’",
	["â’¹"] = "â““",
	["â’º"] = "â“”",
	["â’»"] = "â“•",
	["â’¼"] = "â“–",
	["â’½"] = "â“—",
	["â’¾"] = "â“˜",
	["â’¿"] = "â“™",
	["â“€"] = "â“š",
	["â“"] = "â“›",
	["â“‚"] = "â“œ",
	["â“ƒ"] = "â“",
	["â“„"] = "â“ž",
	["â“…"] = "â“Ÿ",
	["â“†"] = "â“ ",
	["â“‡"] = "â“¡",
	["â“ˆ"] = "â“¢",
	["â“‰"] = "â“£",
	["â“Š"] = "â“¤",
	["â“‹"] = "â“¥",
	["â“Œ"] = "â“¦",
	["â“"] = "â“§",
	["â“Ž"] = "â“¨",
	["â“"] = "â“©",
	["â°€"] = "â°°",
	["â°"] = "â°±",
	["â°‚"] = "â°²",
	["â°ƒ"] = "â°³",
	["â°„"] = "â°´",
	["â°…"] = "â°µ",
	["â°†"] = "â°¶",
	["â°‡"] = "â°·",
	["â°ˆ"] = "â°¸",
	["â°‰"] = "â°¹",
	["â°Š"] = "â°º",
	["â°‹"] = "â°»",
	["â°Œ"] = "â°¼",
	["â°"] = "â°½",
	["â°Ž"] = "â°¾",
	["â°"] = "â°¿",
	["â°"] = "â±€",
	["â°‘"] = "â±",
	["â°’"] = "â±‚",
	["â°“"] = "â±ƒ",
	["â°”"] = "â±„",
	["â°•"] = "â±…",
	["â°–"] = "â±†",
	["â°—"] = "â±‡",
	["â°˜"] = "â±ˆ",
	["â°™"] = "â±‰",
	["â°š"] = "â±Š",
	["â°›"] = "â±‹",
	["â°œ"] = "â±Œ",
	["â°"] = "â±",
	["â°ž"] = "â±Ž",
	["â°Ÿ"] = "â±",
	["â° "] = "â±",
	["â°¡"] = "â±‘",
	["â°¢"] = "â±’",
	["â°£"] = "â±“",
	["â°¤"] = "â±”",
	["â°¥"] = "â±•",
	["â°¦"] = "â±–",
	["â°§"] = "â±—",
	["â°¨"] = "â±˜",
	["â°©"] = "â±™",
	["â°ª"] = "â±š",
	["â°«"] = "â±›",
	["â°¬"] = "â±œ",
	["â°­"] = "â±",
	["â°®"] = "â±ž",
	["â± "] = "â±¡",
	["â±¢"] = "É«",
	["â±£"] = "áµ½",
	["â±¤"] = "É½",
	["â±§"] = "â±¨",
	["â±©"] = "â±ª",
	["â±«"] = "â±¬",
	["â±µ"] = "â±¶",
	["â²€"] = "â²",
	["â²‚"] = "â²ƒ",
	["â²„"] = "â²…",
	["â²†"] = "â²‡",
	["â²ˆ"] = "â²‰",
	["â²Š"] = "â²‹",
	["â²Œ"] = "â²",
	["â²Ž"] = "â²",
	["â²"] = "â²‘",
	["â²’"] = "â²“",
	["â²”"] = "â²•",
	["â²–"] = "â²—",
	["â²˜"] = "â²™",
	["â²š"] = "â²›",
	["â²œ"] = "â²",
	["â²ž"] = "â²Ÿ",
	["â² "] = "â²¡",
	["â²¢"] = "â²£",
	["â²¤"] = "â²¥",
	["â²¦"] = "â²§",
	["â²¨"] = "â²©",
	["â²ª"] = "â²«",
	["â²¬"] = "â²­",
	["â²®"] = "â²¯",
	["â²°"] = "â²±",
	["â²²"] = "â²³",
	["â²´"] = "â²µ",
	["â²¶"] = "â²·",
	["â²¸"] = "â²¹",
	["â²º"] = "â²»",
	["â²¼"] = "â²½",
	["â²¾"] = "â²¿",
	["â³€"] = "â³",
	["â³‚"] = "â³ƒ",
	["â³„"] = "â³…",
	["â³†"] = "â³‡",
	["â³ˆ"] = "â³‰",
	["â³Š"] = "â³‹",
	["â³Œ"] = "â³",
	["â³Ž"] = "â³",
	["â³"] = "â³‘",
	["â³’"] = "â³“",
	["â³”"] = "â³•",
	["â³–"] = "â³—",
	["â³˜"] = "â³™",
	["â³š"] = "â³›",
	["â³œ"] = "â³",
	["â³ž"] = "â³Ÿ",
	["â³ "] = "â³¡",
	["â³¢"] = "â³£",
	["ï¼¡"] = "ï½",
	["ï¼¢"] = "ï½‚",
	["ï¼£"] = "ï½ƒ",
	["ï¼¤"] = "ï½„",
	["ï¼¥"] = "ï½…",
	["ï¼¦"] = "ï½†",
	["ï¼§"] = "ï½‡",
	["ï¼¨"] = "ï½ˆ",
	["ï¼©"] = "ï½‰",
	["ï¼ª"] = "ï½Š",
	["ï¼«"] = "ï½‹",
	["ï¼¬"] = "ï½Œ",
	["ï¼­"] = "ï½",
	["ï¼®"] = "ï½Ž",
	["ï¼¯"] = "ï½",
	["ï¼°"] = "ï½",
	["ï¼±"] = "ï½‘",
	["ï¼²"] = "ï½’",
	["ï¼³"] = "ï½“",
	["ï¼´"] = "ï½”",
	["ï¼µ"] = "ï½•",
	["ï¼¶"] = "ï½–",
	["ï¼·"] = "ï½—",
	["ï¼¸"] = "ï½˜",
	["ï¼¹"] = "ï½™",
	["ï¼º"] = "ï½š",
	["ð€"] = "ð¨",
	["ð"] = "ð©",
	["ð‚"] = "ðª",
	["ðƒ"] = "ð«",
	["ð„"] = "ð¬",
	["ð…"] = "ð­",
	["ð†"] = "ð®",
	["ð‡"] = "ð¯",
	["ðˆ"] = "ð°",
	["ð‰"] = "ð±",
	["ðŠ"] = "ð²",
	["ð‹"] = "ð³",
	["ðŒ"] = "ð´",
	["ð"] = "ðµ",
	["ðŽ"] = "ð¶",
	["ð"] = "ð·",
	["ð"] = "ð¸",
	["ð‘"] = "ð¹",
	["ð’"] = "ðº",
	["ð“"] = "ð»",
	["ð”"] = "ð¼",
	["ð•"] = "ð½",
	["ð–"] = "ð¾",
	["ð—"] = "ð¿",
	["ð˜"] = "ð‘€",
	["ð™"] = "ð‘",
	["ðš"] = "ð‘‚",
	["ð›"] = "ð‘ƒ",
	["ðœ"] = "ð‘„",
	["ð"] = "ð‘…",
	["ðž"] = "ð‘†",
	["ðŸ"] = "ð‘‡",
	["ð "] = "ð‘ˆ",
	["ð¡"] = "ð‘‰",
	["ð¢"] = "ð‘Š",
	["ð£"] = "ð‘‹",
	["ð¤"] = "ð‘Œ",
	["ð¥"] = "ð‘",
	["ð¦"] = "ð‘Ž",
	["ð§"] = "ð‘",
}

local function TypeCheck( Arg, Type, ArgNumber, FuncName )
	local ArgType = type( Arg )

	if ArgType ~= Type then
		error( StringFormat( "Bad argument #%i to '%s' (%s expected, got %s)",
			ArgNumber, FuncName, Type, ArgType ), 2 )
	end
end

local function IdentityValid( Bytes ) return Bytes end

local function IsValidContinuationByte( Byte )
	-- Leftmost 2 bits must be 10
	return Byte and BitBand( Byte, 0xC0 ) == 0x80
end

local function GetNumContinuationBytes( FirstByte )
	-- Number of continuation bytes is the number of 1-bits at the start - 1, e.g. 0b110xxxxx has 1 continuation byte,
	-- 0b1110xxxx has 2 and 0b1111xxxx has 3.
	local ThirdBit = BitRShift( BitBand( FirstByte, 0x20 ), 5 )
	return BitRShift( BitBand( FirstByte, 0x40 ), 6 )
		+ ThirdBit
		-- Multiplying here accounts for the case of a byte like 0b1101xxxx.
		+ ThirdBit * BitRShift( BitBand( FirstByte, 0x10 ), 4 )
end

local ValidityChecks = {}
for i = 0xC2, 0xF4 do
	ValidityChecks[ i ] = IdentityValid
end
-- Check for overlong encoding.
ValidityChecks[ 0xE0 ] = function( Bytes ) return Bytes[ 2 ] >= 0xA0 and Bytes or nil end
ValidityChecks[ 0xF0 ] = function( Bytes ) return Bytes[ 2 ] >= 0x90 and Bytes or nil end
ValidityChecks[ 0xF4 ] = function( Bytes ) return Bytes[ 2 ] <= 0x8F and Bytes or nil end
-- Check for UTF-16 surrogate halves (0xD800 - 0xDFFF).
ValidityChecks[ 0xED ] = function( Bytes ) return Bytes[ 2 ] <= 0x9F and Bytes or nil end

-- Internal cache table to avoid creating tables for every character. Up to 4 bytes + the number of bytes total.
local UTF8Bytes = require "table.new"( 5, 0 )
local function BytesOf( FirstByte )
	TableClear( UTF8Bytes )
	UTF8Bytes[ 5 ] = 1
	UTF8Bytes[ 1 ] = FirstByte
	return UTF8Bytes
end

local function ASCII( String, Index, FirstByte )
	return BytesOf( FirstByte )
end

local function Invalid() return nil end

local function UTF8( String, Index, FirstByte )
	local NumContinuationBytes = GetNumContinuationBytes( FirstByte )
	local Bytes = BytesOf( FirstByte )
	Bytes[ 5 ] = NumContinuationBytes + 1

	for i = 1, NumContinuationBytes do
		local Byte = StringByte( String, Index + i )
		if not IsValidContinuationByte( Byte ) then
			-- Every continuation byte must have the same 10xxxxxx structure.
			return nil
		end

		Bytes[ i + 1 ] = Byte
	end

	return ValidityChecks[ FirstByte ]( Bytes )
end

local ByteHandlers = {}

-- Trivial case, no continuation bytes.
for i = 0, 0x7F do
	ByteHandlers[ i ] = ASCII
end

-- Byte is invalid, or a continuation byte.
for i = 0x80, 0xC1 do
	ByteHandlers[ i ] = Invalid
end

-- Byte is start of UTF-8 character.
for i = 0xC2, 0xF4 do
	ByteHandlers[ i ] = UTF8
end

-- Byte is invalid, or a continuation byte.
for i = 0xF5, 0xFF do
	ByteHandlers[ i ] = Invalid
end

--[[
	Returns the bytes used by the UTF-8 character.

	Inputs: String to check, Index byte to start at.
	Output: Table of bytes used by the UTF-8 character.
]]
local function GetUTF8Bytes( String, Index )
	local FirstByte = StringByte( String, Index )
	if not FirstByte then return nil end

	return ByteHandlers[ FirstByte ]( String, Index, FirstByte )
end

--[[
	Returns the number of bytes used by the UTF-8 character.

	Inputs: String to check, Index byte to start at.
	Output: Number of bytes used by the UTF-8 character.
]]
local function GetNumUTF8Bytes( String, Index )
	local Bytes = GetUTF8Bytes( String, Index )
	if Bytes then
		return Bytes[ 5 ]
	end

	return nil
end

--[[
	Checks if a string is a valid UTF8 character.

	Input: String to check, optional byte index of the string to start from.
	Output: True if valid, false otherwise.
]]
function string.IsValidUTF8( String, Index )
	TypeCheck( String, "string", 1, "IsValidUTF8" )
	if Index then
		TypeCheck( Index, "number", 2, "IsValidUTF8" )
	end

	return GetUTF8Bytes( String, Index or 1 ) ~= nil
end

--[[
	Returns up to 4 bytes of data representing the components of a UTF8 character.

	Input: String to get character bytes from, optional byte index of the string to start from.
	Output: Up to 4 bytes of data. Returns nil if the character is invalid UTF8.
]]
function string.GetUTF8Bytes( String, Index )
	TypeCheck( String, "string", 1, "GetUTF8Bytes" )
	if Index then
		TypeCheck( Index, "number", 2, "GetUTF8Bytes" )
	end

	local Bytes = GetUTF8Bytes( String, Index or 1 )
	if Bytes then
		return unpack( Bytes, 1, Bytes[ 5 ] )
	end
end

--[[
	Converts a character numeric value into a UTF-8 character.
]]
local function UTF8Char( Char )
	if Char < 0 or Char > 0x10FFFF then
		error( "bad argument #1 to 'UTF8Char' (out of range)", 2 )
	end

	if Char < 0x80 then
		return StringChar( Char )
	end

	if Char < 0x800 then
		return StringChar(
			BitBor( 0xC0, BitBand( BitRShift( Char, 6 ), 0x1F ) ),
			BitBor( 0x80, BitBand( Char, 0x3F ) )
		)
	end

	if Char < 0x10000 then
		return StringChar(
			BitBor( 0xE0, BitBand( BitRShift( Char, 12 ), 0x0F ) ),
			BitBor( 0x80, BitBand( BitRShift( Char, 6 ), 0x3F ) ),
			BitBor( 0x80, BitBand( Char, 0x3F ) )
		)
	end

	return StringChar(
		BitBor( 0xF0, BitBand( BitRShift( Char, 18 ), 0x07 ) ),
		BitBor( 0x80, BitBand( BitRShift( Char, 12 ), 0x3F ) ),
		BitBor( 0x80, BitBand( BitRShift( Char, 6 ), 0x3F ) ),
		BitBor( 0x80, BitBand( Char, 0x3F ) )
	)
end
string.UTF8Char = UTF8Char

do
	local function GetMask( Bits )
		local Mask = 1
		for i = 1, Bits do
			Mask = Mask + BitLShift( 1, i )
		end
		return Mask
	end

	--[[
		Returns the UTF-8 code point for the given bytes.
	]]
	function string.UTF8CodePoint( ... )
		local Bytes = select( "#", ... )
		if Bytes == 0 or Bytes > 4 then
			error( "incorrect number of arguments to UTF8CodePoint, expected between 1 and 4 bytes", 2 )
		end

		if Bytes == 1 then
			return BitBand( select( 1, ... ), 0x7F )
		end

		-- Bits is really Bits - 1, as we start from 2 ^ 0.
		local Bits = 5
		local CodePoint = 0

		for i = Bytes, 1, -1 do
			local Byte = select( i, ... )
			if Byte ~= nil then
				local ShiftAmount = ( Bytes - i ) * 6

				if i == 1 then
					Bits = 6 - Bytes
				end

				local Mask = GetMask( Bits )
				-- Cut out extra byte data, then shift.
				CodePoint = CodePoint + BitLShift( BitBand( Byte, Mask ), ShiftAmount )
			end
		end

		return CodePoint
	end
end

local REPLACEMENT_CHAR = UTF8Char( 0xFFFD )
--[[
	Encodes a string into valid UTF-8, returning a table of UTF-8 characters.
]]
local function UTF8Encode( String )
	local CurByte = 1
	local Bytes = #String
	local Count = 0
	local Chars = {}

	while CurByte <= Bytes do
		local CharBytes = GetNumUTF8Bytes( String, CurByte )
		local Char

		if not CharBytes then
			CharBytes = 1
			Char = REPLACEMENT_CHAR
		else
			Char = StringSub( String, CurByte, CurByte + CharBytes - 1 )
		end

		Count = Count + 1
		Chars[ Count ] = Char
		CurByte = CurByte + CharBytes
	end

	return Chars
end
string.UTF8Encode = UTF8Encode

--[[
	Encodes a string into valid UTF-8, returning the string.
]]
function string.UTF8EncodeString( String )
	return TableConcat( UTF8Encode( String ), "" )
end

--[[
	Returns the number of characters (not bytes) in a UTF-8 string.

	Input: String
	Output: Number of UTF-8 characters.
]]
function string.UTF8Length( String )
	TypeCheck( String, "string", 1, "UTF8Length" )

	return #UTF8Encode( String )
end

--[[
	Returns the part of the string between Start and End where Start and End are UTF-8
	character positions instead of bytes.

	Inputs: String, starting character position, ending character position.
	Output: String between the two points.
]]
function string.UTF8Sub( String, Start, End )
	End = End or -1

	TypeCheck( String, "string", 1, "UTF8Sub" )
	TypeCheck( Start, "number", 2, "UTF8Sub" )
	TypeCheck( End, "number", 3, "UTF8Sub" )

	local Chars = UTF8Encode( String )
	local UTF8Length = #Chars
	if UTF8Length == 0 then return "" end

	local StartChar = Start >= 0 and Start or UTF8Length + Start + 1
	local EndChar = End >= 0 and End or UTF8Length + End + 1

	if StartChar > EndChar or EndChar <= 0 then
		return ""
	end

	return TableConcat( Chars, "", Max( StartChar, 1 ), Min( EndChar, UTF8Length ) )
end

--[[
	Replaces UTF-8 characters based on a mapping table.

	Inputs: String, mapping table.
	Output: New string with all characters that were present in the mapping table replaced.
]]
local function UTF8Replace( String, MapTable )
	TypeCheck( String, "string", 1, "UTF8Replace" )
	TypeCheck( MapTable, "table", 2, "UTF8Replace" )

	local Chars = UTF8Encode( String )
	for i = 1, #Chars do
		local Mapping = MapTable[ Chars[ i ] ]
		if Mapping then
			Chars[ i ] = Mapping
		end
	end

	return TableConcat( Chars, "" )
end
string.UTF8Replace = UTF8Replace

function string.UTF8Upper( String )
	return UTF8Replace( String, UTF8LowerToUpper )
end

function string.UTF8Lower( String )
	return UTF8Replace( String, UTF8UpperToLower )
end

--[[
	Reverses a UTF-8 string.

	Input: String.
	Output: Reversed UTF-8 aware string.
]]
function string.UTF8Reverse( String )
	TypeCheck( String, "string", 1, "UTF8Reverse" )

	local Chars = UTF8Encode( String )
	return TableConcat( TableReverse( Chars ), "" )
end
